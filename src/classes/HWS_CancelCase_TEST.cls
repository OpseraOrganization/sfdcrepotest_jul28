@istest
Public Class HWS_CancelCase_TEST{
	Public Static testmethod void cancelChildCasesTest(){
		String standardPricebookId =Test.getStandardPricebookId();
		Id legalAcc = HWS_Utilty.getRecordTypeByName('Account',HWS_Constants.LEGAL_ENTITY);
		Id CustomerAcc = HWS_Utilty.getRecordTypeByName('Account',HWS_Constants.Customer);
		Id childRecordType = HWS_Utilty.getRecordTypeByName('Case',HWS_Constants.HWS_ADVANCE_EXCHANGE_IN_DAYS);
		Id parentRecordType = HWS_Utilty.getRecordTypeByName('Case',HWS_Constants.HWS_PARENT_CASE);
		Id AccountRecordType = HWS_Utilty.getRecordTypeByName('Account',HWS_Constants.LOGISTIC_ACCOUNT_EXISTING);
		Product2 prod = HWS_DataFactory_TEST.insertproduct2();
		prod.ProductCode = '1234';
		insert prod;		
		Account ACC1 = new Account();
		ACC1.Name = 'Testing Data For Case Insert';
		ACC1.ngERP__c = '1';
		ACC1.BillingCountry = 'India';
		ACC1.BillingStreet = 'Gachibowli, Gachibowli';
		ACC1.BillingCity = 'Hyderabad';
		ACC1.BillingPostalCode = '500071';
		ACC1.BillingState = 'TELANGANA';
		ACC1.RecordTypeId = AccountRecordType;
		insert ACC1;
		
		Account parentAcc = new Account();
		Id custRecordTypeId = Schema.SObjectType.Account.getRecordTypeInfosByName().get('Customer').getRecordTypeId();
		parentAcc.RecordTypeId = custRecordTypeId;
		parentAcc.Customer_Compliance__c = 'US_AT&T';
		parentAcc.P20_Logistic_ID__c = '1234';
		parentAcc.name='testCustomer';
		parentAcc.BillingCountry = 'India';
		parentAcc.BillingStreet = 'Test';
		parentAcc.BillingCity ='Test';
		parentAcc.BillingPostalCode = '1234';
		insert parentAcc;
		
		Account acc = HWS_DataFactory_TEST.insertAccount(); 
		acc.RecordTypeId =  legalAcc;
		acc.ParentId = parentAcc.Id;
		insert acc;
		
		Asset ast = HWS_DataFactory_TEST.insertAsset(acc,prod);
		Id assetRecordType = HWS_Utilty.getRecordTypeByName('Asset','HWS_Covered_Part');
		ast.RecordTypeId = assetRecordType;
		ast.HWS_SourceSystem__c  = 'Puma1';
		insert ast;
		
		Case parentCase1= HWS_DataFactory_TEST.createCase(parentRecordType);
		parentCase1.AccountId = acc.Id;
		parentCase1.HWS_Customer_Reference_Number__c='123456';
		parentCase1.HWS_Delivery_Additional_Information__c='test additional info';
		parentCase1.HWS_Shipment_Recipient_Name__c='test recipient';
		parentCase1.HWS_Shipment_Recipient_Phone__c='7893556678';
		parentCase1.HWS_Customer_PO__c='456798';
		parentCase1.Origin='Phone';
		parentCase1.Hws_Ship_to_Party_Address__c = ACC1.Id;
		parentCase1.HWS_Sellable_Product__c = prod.Id;		
		insert parentCase1;	   
		//system.debug('Parent case records:'+parentCase1);		
		Case childCase= HWS_DataFactory_TEST.createCase(childRecordType);
		childCase.AccountId = acc.Id;
		childCase.parentId=parentCase1.Id;
		childCase.AssetId=ast.Id;
		childCase.status='Ordered';
		childCase.HWS_Site_ID__c='12345';
		childCase.HWS_Site_Information__c='Test info';
		childCase.HWS_Replacement_Unit_Serial_Number__c='1245786';
		childCase.HWS_Fault_Reported_By_Phone__c='7893556678';
		childCase.HWS_Fault_Reported_By_Name__c='Test User';
		childCase.HWS_Fault_Reported_By_Email__c='user@test.com';
		childCase.HWS_Faulty_Serial_Number__c='124587869';
		childCase.HWS_Sellable_Product__c = prod.Id;
		childCase.Hws_Ship_to_Party_Address__c = ACC1.Id;
		insert childCase;
		Case childCase1= HWS_DataFactory_TEST.createCase(childRecordType);
		childCase1.AccountId = acc.Id;
		childCase1.parentId=parentCase1.Id;
		childCase1.AssetId=ast.Id;
		childCase1.status='Ordered';
		childCase1.HWS_Site_ID__c='12345';
		childCase1.HWS_Site_Information__c='Test info';
		childCase1.HWS_Replacement_Unit_Serial_Number__c='1245786';
		childCase1.HWS_Fault_Reported_By_Phone__c='7893556678';
		childCase1.HWS_Fault_Reported_By_Name__c='Test User';
		childCase1.HWS_Fault_Reported_By_Email__c='user@test.com';
		childCase1.HWS_Faulty_Serial_Number__c='12458790';
		childCase1.HWS_Sellable_Product__c = prod.Id;
		childCase1.Hws_Ship_to_Party_Address__c = ACC1.Id;
		insert childCase1;
		Case childCase2 = HWS_DataFactory_TEST.createCase(childRecordType);
		childCase2.AccountId = acc.Id;
		childCase2.parentId=parentCase1.Id;
		childCase2.AssetId=ast.Id;
		childCase2.status='Shipped';
		childCase2.HWS_Site_ID__c='12345';
		childCase2.HWS_Site_Information__c='Test info';
		childCase2.HWS_Replacement_Unit_Serial_Number__c='1245786';
		childCase2.HWS_Fault_Reported_By_Phone__c='7893556678';
		childCase2.HWS_Fault_Reported_By_Name__c='Test User';
		childCase2.HWS_Fault_Reported_By_Email__c='user@test.com';
		childCase2.HWS_Faulty_Serial_Number__c='124587098';
		childCase2.HWS_Sellable_Product__c = prod.Id;
		childCase2.Hws_Ship_to_Party_Address__c = ACC1.Id;
		insert childCase2;
		case c = [select id from case where id = : parentCase1.id];
		system.debug('********parent case id1***'+c);
		String parentCaseId = string.valueOf(c.Id); 
		system.debug('********parent case id***'+parentCaseId);
		test.startTest();
		HWS_CancelCase.cancelChildCases(parentCaseId);
		test.stopTest();
	}
}