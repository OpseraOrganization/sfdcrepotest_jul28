<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <validationRules>
        <fullName>Lead_Status_Read_Only</fullName>
        <active>true</active>
        <description>Req#2161 Lead Status &quot;Read Only&quot;</description>
        <errorConditionFormula>AND(
NOT(
OR(
$Profile.Name = &apos;System Administrator&apos;,
$Profile.Name = &apos;Data Loader Profile&apos;,
$Profile.Name = &apos;Nokia Admin Profile&apos;,
$Profile.Name = &apos;Global Process Admin Profile&apos;	
)
),
OR(
RecordType.Name = &apos;Distributor Deal Registration&apos;,
RecordType.Name = &apos;Indirect Deal Registration&apos;,
RecordType.Name = &apos;Reseller Deal Registration&apos;
),
AND(
$Permission.PRM_PSM_Permission = FALSE,
$Permission.PRM_Deal_Registration_Permission = FALSE
),
OR(
AND(
ISCHANGED(Status),
NOT(AND(PRIORVALUE(Status) = &apos;Approved&apos;,
ISPICKVAL(Status, &apos;Closed - Converted (Qualified)&apos;)))
),
AND(	
NOT(ISPICKVAL(Status, &apos;Open&apos;)),
ISNEW()
)
)
)</errorConditionFormula>
        <errorDisplayField>Status</errorDisplayField>
        <errorMessage>You can&apos;t Change the Lead Status Manually</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Lead_Status_cannot_be_changd_to_Approved</fullName>
        <active>true</active>
        <description>Neither a Partner user nor a Partner relationship manager should be able to change the Lead Status in the partner portal to &quot;Approved&quot;</description>
        <errorConditionFormula>AND (
OR($Profile.Name = &apos;PRM Partner Community User Login&apos;,$Profile.Name = &apos;PRM Partner Relationship Manager Login&apos;),
ISCHANGED(Status),ISPICKVAL(Status, &apos;Approved&apos;)
)</errorConditionFormula>
        <errorDisplayField>Status</errorDisplayField>
        <errorMessage>Status cannot be changed to &quot;Approved&quot;.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Manual_Change_Lead_Status_to_Convert</fullName>
        <active>true</active>
        <errorConditionFormula>AND($Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name,IF(!IsConverted,  OR(ISPICKVAL(Status , &apos;Closed - Converted (Qualified)&apos;), ISPICKVAL(Status , &apos;Converted To Contact&apos;)),FALSE))</errorConditionFormula>
        <errorMessage>Lead Status &quot;Closed - Converted (Qualified)&quot; or &quot;Converted To Contact&quot; cannot be selected manually. Please convert the lead with Convert button.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Mkt_Queue_owned_leads_cannot_in_Progress</fullName>
        <active>true</active>
        <errorConditionFormula>ISCHANGED(Status) 
&amp;&amp; RecordType.DeveloperName = &apos;Direct_Sales&apos; 
&amp;&amp; BEGINS(OwnerId , &apos;00G&apos;) 
&amp;&amp; ( 
ISPICKVAL(Status, &apos;Working - Contacted&apos;) || ISPICKVAL(Status, &apos;Working - Target Team&apos;) 
)</errorConditionFormula>
        <errorMessage>Status cannot be in Working phase if the Lead is owned by a Queue</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>PRM_Restrict_Deal_Reg_Reassignment</fullName>
        <active>true</active>
        <description>SFPRM-177</description>
        <errorConditionFormula>AND(
 OR(
			 RecordType.DeveloperName = &apos;Deal_Registration&apos;,
			 RecordType.DeveloperName = &apos;PRMDistributor_Deal_Registration&apos;,
			 RecordType.DeveloperName = &apos;Distributor_Deal_Registration_Approved&apos;,
			 RecordType.DeveloperName = &apos;PRMIndirect_Deal_Registration&apos;,
			 RecordType.DeveloperName = &apos;Indirect_Deal_Registration_Approved&apos;,
			 RecordType.DeveloperName = &apos;PRM_Standard_Deal_registration&apos;,
			 RecordType.DeveloperName = &apos;Reseller_Deal_Registration_Approved&apos;
    ),
		OR(
				Owner:User.Profile.Name = &apos;PRM Partner Relationship Manager Login&apos;,
				Owner:User.Profile.Name = &apos;PRM Partner Community User Login&apos;
				),
  Owner:User.Contact.AccountId	!= PartnerAccount.Id,
		PartnerAccount.Id != null,
		ISCHANGED(OwnerId) 
)</errorConditionFormula>
        <errorDisplayField>OwnerId</errorDisplayField>
        <errorMessage>You can&apos;t assign a Deal Registration to a User from a different Partner Account</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>mkt_CannotBeConvertedToContactWithOpp</fullName>
        <active>true</active>
        <description>This validation rule prevents the leads from getting converted to  &quot;converted to contact&quot; status if opportunity is either selected or created as part of the conversion</description>
        <errorConditionFormula>ISCHANGED(IsConverted) &amp;&amp;  IsConverted==true
&amp;&amp; ((RecordType.DeveloperName = &apos;Direct_Sales&apos;)||(RecordType.DeveloperName = &apos;TXLE_Lead&apos;))
&amp;&amp; ConvertedOpportunityId !=null
&amp;&amp; ISPICKVAL(Status, &apos;Converted To Contact&apos;)</errorConditionFormula>
        <errorMessage>Lead Conversion Status Cannot Be Converted To Contact With Opportunity Association</errorMessage>
    </validationRules>
</CustomObject>
