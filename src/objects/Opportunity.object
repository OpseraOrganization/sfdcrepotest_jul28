<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <validationRules>
        <fullName>Check_for_Invalid_Phase_Status</fullName>
        <active>true</active>
        <description>@TSALEM - check o make sure that there is a phase status selected before setting new stage
RecordType.DeveloperName != $Label.DummyOpportunity) - Line added by CPQ team on 07-10-2017</description>
        <errorConditionFormula>AND(ISPICKVAL( Phase_Status__c , &quot;&quot;),  ($Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name),OR($RecordType.DeveloperName = &apos;Direct_Record_Type&apos;, 
 $RecordType.DeveloperName = &apos;Indirect_Record_Type&apos; 
 ),RecordType.DeveloperName != $Label.DummyOpportunity)</errorConditionFormula>
        <errorDisplayField>Phase_Status__c</errorDisplayField>
        <errorMessage>You must select a valid phase status</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Freeze_Unweighted_Amount</fullName>
        <active>true</active>
        <description>Req 636: Unweighted Amount shoudnt be changed after &quot;Develop Opportunity&quot; Sales Phase.</description>
        <errorConditionFormula>AND ( 
OR(ISPICKVAL( StageName , &quot;Create Offer (Bid)&quot;), 
ISPICKVAL( StageName , &quot;Win the Case (Negotiate)&quot;), 
ISPICKVAL( StageName , &quot;Handover (Prepare for Delivery)&quot;)
), 
ISCHANGED(    Amount    ),
 Is_Automated__c=false, 

($Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name)
)</errorConditionFormula>
        <errorDisplayField>Amount</errorDisplayField>
        <errorMessage>Unweighted Amount cannot be changed after &quot;Develop Opportunity&quot; Sales Phase.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Initial_Offer_Due_Date</fullName>
        <active>true</active>
        <description>requirement 572: Initial Offer Due Date should be : 
planned dates. Planned dates must be: 
&gt; G3 planned date 
AND 
&lt; G5 planned date 
AND cannot be set as past date.</description>
        <errorConditionFormula>OR(
	Initial_Offer_Planned_Date__c &lt;  G3_Planned_Date__c, 
	Initial_Offer_Planned_Date__c &gt;  G5_Planned_Date__c, 
	AND( 
		ISCHANGED(Initial_Offer_Planned_Date__c ),
		Initial_Offer_Planned_Date__c &lt; today()
	),
	AND( 
		ISNEW(),
		Initial_Offer_Planned_Date__c &lt; today()
	)
) &amp;&amp; ($Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name)</errorConditionFormula>
        <errorDisplayField>Initial_Offer_Planned_Date__c</errorDisplayField>
        <errorMessage>Initial Offer Planned Date must be in between G3 planned date and G5 planned date and must not be in past.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>NF_PSRAvoid_Changing_Submission_ExePhase</fullName>
        <active>true</active>
        <description>IWA Requirement
3786
Sprint 12</description>
        <errorConditionFormula>AND( 
$Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name, 
OR($RecordType.DeveloperName = &apos;Pre_Sales_Risk_Opportunity&apos;, 
$RecordType.DeveloperName=&apos;Pre_Sales_Risk_Opportunity_read_only&apos;
), 

OR(
AND(
OR( 
ISPICKVAL(StageName , &apos;Preparation&apos;), 
ISPICKVAL(StageName , &apos;In Execution&apos;), 
ISPICKVAL(StageName , &apos;Completed&apos;), 
ISPICKVAL(StageName , &apos;Cancelled&apos;) 
), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Submitted For Approval&apos;), 
!OR( 

NF_PRE_Tech_Field__c=&apos;Gate Approved&apos;, 
NF_PRE_Tech_Field__c=&apos;Gate Rejected&apos; 

)
),
AND(
OR( 
ISPICKVAL(StageName ,&apos;Submitted For Approval&apos;), 
ISPICKVAL(StageName ,&apos;Preparation&apos;) 

), 
ISPICKVAL(PRIORVALUE(StageName),&apos;In Execution&apos;), 
NOT(ISBLANK(NF_PRE_Tech_Field__c)) 
)
)
)</errorConditionFormula>
        <errorDisplayField>Legal_Entity__c</errorDisplayField>
        <errorMessage>You cannot change the Sales Phase manually.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>NF_PhaseStatusCantBeChanged</fullName>
        <active>true</active>
        <errorConditionFormula>AND ( 
$Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name,
$Profile.Name&lt;&gt;&apos;System Administrator&apos;, 
OR( 
ISPICKVAL(Phase_Status__c , &quot;Submitted for G2 Approval&quot;) , 

ISPICKVAL(Phase_Status__c , &quot;Submitted for G3 Approval&quot;) , 

ISPICKVAL(Phase_Status__c , &quot;Submitted for G4 Approval&quot;) , 

ISPICKVAL(Phase_Status__c , &quot;Submitted for G5 Approval&quot;) , 

ISPICKVAL(Phase_Status__c , &quot;Submitted for G6 Approval&quot;) ), 

ISPICKVAL( Apttus_Approval__Approval_Status__c , &quot;Not submitted&quot;))</errorConditionFormula>
        <errorMessage>You can&apos;t change the phase status to &quot;Submitted&quot; manually. Please submit the gate for approval.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>PSR_Avoid_Creating_PreSales</fullName>
        <active>true</active>
        <description>PreSales Requirement: 3459, Sprint 11</description>
        <errorConditionFormula>AND( 
AND( 
ISNEW(), 
$Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name, 
RecordType.DeveloperName = &apos;Pre_Sales_Risk_Opportunity&apos;
), 

OR( 
OR( 
PSR_Reference_Opportunity__r.RecordType.DeveloperName = &apos;Pre_Sales_Risk_Opportunity&apos;, 
PSR_Reference_Opportunity__r.RecordType.DeveloperName = &apos;Pre_Sales_Risk_Opportunity_read_only&apos;
), 
OR( 
PSR_Reference_Opportunity__r.RecordType.DeveloperName = &apos;Read_Only&apos;, 
PSR_Reference_Opportunity__r.RecordType.DeveloperName = &apos;Read_Only_Indirect&apos; 
), 
OR( 
ISPICKVAL( PSR_Reference_Opportunity__r.StageName, &apos;Identify Opportunity&apos;), 
ISPICKVAL( PSR_Reference_Opportunity__r.StageName, &apos;Completed&apos;) 
) 
) 
)</errorConditionFormula>
        <errorMessage>You cannot create a Pre-Sales Risk Opportunity from another Pre-Sales Risk Opportunity or from a Sales Opportunity, that is either in the Identify, Closed or Cancelled stage.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>PSR_Prohibit_double_reset</fullName>
        <active>true</active>
        <errorConditionFormula>AND ($Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name,
 PSR_Reset_PSRO__c  = true,
 ISPICKVAL(PSR_Pre_Sales_Risk_Opportunity_Sub_Type__c, &quot;Risk Order with Risk Shipment&quot;),
 ISCHANGED( PSR_Pre_Sales_Risk_Opportunity_Sub_Type__c ) ,
 ISPICKVAL( StageName , &quot;In Execution&quot;) 
)</errorConditionFormula>
        <errorMessage>You cannot request additional risk shipment as this Pre-Sales Risk Opportunity has already been reset once before.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Partner_User_Name_Field_Mandetory</fullName>
        <active>true</active>
        <errorConditionFormula>AND(NOT( 
$Profile.Name = &apos;Data Loader Profile&apos; 
),
ISPICKVAL(Lead_Type__c , &apos;&apos;),
OR(
PRMTechnical_Support_Requested__c = TRUE,
PRMPricing_Support_Requested__c = TRUE, 
PRMOther_Support_Requested__c = TRUE), 
ISBLANK(PRMPartner_User_Name__c)
)</errorConditionFormula>
        <errorDisplayField>PRMPartner_User_Name__c</errorDisplayField>
        <errorMessage>Before Requesting for Technical/Pricing/Other Support, you should populate Partner User.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Partner_from_Opportunity_Account</fullName>
        <active>true</active>
        <description>Partner Should be from Same account of Opportunity</description>
        <errorConditionFormula>AND( 
(RecordTypeId == $Label.Create_Indirect_Sales_Opportunity), 
NOT( ISBLANK( PRMPartner_User_Name__c ) ), 
PRMPartner_User_Name__r.Contact.AccountId &lt;&gt; Account.Id, 
NOT( 
OR( 
ISPICKVAL( Lead_Type__c ,&apos;Distributor Deal Registration&apos; ), 
ISPICKVAL( Lead_Type__c ,&apos;Indirect Deal Registration&apos; ), 
ISPICKVAL( Lead_Type__c , &apos;Reseller Deal Registration&apos;) 
) 
) , 
CONTAINS(PRMPartner_User_Name__r.Profile.Name, &apos;PRM Partner&apos;),
NOT( 
$Profile.Name = &apos;Data Loader Profile&apos; 
) 
)</errorConditionFormula>
        <errorDisplayField>PRMPartner_User_Name__c</errorDisplayField>
        <errorMessage>Please select correct Partner User Name from Same Account.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Restrict_Currency_Change_Lightning</fullName>
        <active>false</active>
        <description>To restrict currency change in lightning UI post salesforce Winter 19 release
Issue was fixed Dec 12, turned off Vrule on 12/19/18 by Brenda Sheman.</description>
        <errorConditionFormula>AND( 
ISCHANGED(CurrencyIsoCode), 
$User.UIThemeDisplayed=&quot;Theme4d&quot;, $Profile.Name != &quot;System Administrator&quot;,$Profile.Name != &quot;Data Loader Profile&quot; 
)</errorConditionFormula>
        <errorMessage>Due to a temporary issue, you are not allowed to change the currency in Lightning. Please raise a support ticket to have your currency changed.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Risk_Details_Check</fullName>
        <active>true</active>
        <description>If one field on the Risk section is filled, you need to fill all the RISK fields.You do not need to fill Upside fields  (Req:561)</description>
        <errorConditionFormula>AND(
($Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name),
OR(
ISBLANK(  Risk_Action_plan__c  ),  
ISBLANK(  Risk_Deadline__c  ) , 
ISBLANK(  Risk_Owner__c ) ,
ISBLANK(  Project_description_major_reason__c ) ,
ISPICKVAL ( Risk_Rating__c ,&apos;&apos; ) ,
ISBLANK( Risk_Support_required__c ), 
ISPICKVAL ( Risk_type__c,&apos;&apos;)
),
 
 
NOT(
AND(
ISBLANK(  Risk_Action_plan__c  ),  
ISBLANK(  Risk_Deadline__c  ) , 
ISBLANK(  Risk_Owner__c ) ,
ISBLANK(  Project_description_major_reason__c ) ,
ISPICKVAL ( Risk_Rating__c ,&apos;&apos; ) ,
ISBLANK( Risk_Support_required__c ), 
ISPICKVAL ( Risk_type__c,&apos;&apos;) 
)
)
)</errorConditionFormula>
        <errorMessage>Please Fill All  The Risk Details</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Upside_Details_Check</fullName>
        <active>true</active>
        <description>If one field on the Upside section is filled, you need to fill all the UpSide fields and You do not need to fill Risk Details. (Req:561)</description>
        <errorConditionFormula>AND(
OR(
ISBLANK( Upside_Action_plan__c ),  ISBLANK( Upside_Deadline__c ) , ISBLANK( Upside_Owner__c ) ,
ISBLANK( Upside_Project_description_major_reason__c) ,
ISPICKVAL (Upside_Rating__c,&apos;&apos; ) ,
ISBLANK(Upside_Support_required__c)
),
NOT(
AND(
ISBLANK( Upside_Action_plan__c ),  ISBLANK( Upside_Owner__c ) ,
ISBLANK( Upside_Deadline__c ) , ISBLANK( Upside_Project_description_major_reason__c) ,
ISPICKVAL (Upside_Rating__c,&apos;&apos; ) ,
ISBLANK(Upside_Support_required__c)
)
),
($Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name)


)</errorConditionFormula>
        <errorMessage>Please Fill All The Upside Details</errorMessage>
    </validationRules>
</CustomObject>
