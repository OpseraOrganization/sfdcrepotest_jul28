<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <enableEnhancedLookup>true</enableEnhancedLookup>
    <validationRules>
        <fullName>Choose_Past_Periods</fullName>
        <active>true</active>
        <description>Forecast Categories (Upside, Risk, Secure, RoP) cannot have Periods selected which end date is in the past(Req:186).06-10-2017 AJ: Req.#2897, Added bypass in Validation to allow old period OIF line creation for Upsell Opportunity at G5 gate confirmation.</description>
        <errorConditionFormula>AND( 
$Profile.Name&lt;&gt; $Label.Data_Loader_Profile_Name, 
OR(AND(ISNEW(), Opportunity__r.Is_Auto_Upsell__c &lt;&gt; true),ISCHANGED(Forecast_Category__c), ISCHANGED( POPlanReceipt__c)), 
OR(ISPICKVAL( Forecast_Category__c , &quot;Risk&quot;),ISPICKVAL( Forecast_Category__c, &quot;Upside&quot;),ISPICKVAL( Forecast_Category__c, &quot;Secure&quot;), ISPICKVAL( Forecast_Category__c, &quot;ROP&quot;), ISPICKVAL( Forecast_Category__c, &quot;Excluded&quot;)), 
POPlanReceipt__r.End_Date__c &lt; Today(), 
Allocation__c = false 
)</errorConditionFormula>
        <errorDisplayField>POPlanReceipt__c</errorDisplayField>
        <errorMessage>An open OIF line cannot have a past PO Plan / Receipt period. Please change period or Forecast Category.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Compare_the_Rev_Rec_Plan_and_Po_Plan</fullName>
        <active>true</active>
        <description>That makes sure, that Rev Rec Plan / Receipt period is greater or equal PO Plan / Receipt period (Req::885)</description>
        <errorConditionFormula>AND( 
( $Profile.Name&lt;&gt; $Label.Data_Loader_Profile_Name ), 
(Rev_RecPlan_Receipt__r.Start_Date__c &lt; POPlanReceipt__r.Start_Date__c), 
(Rev_RecPlan_Receipt__r.End_Date__c &lt; POPlanReceipt__r.End_Date__c), 
Allocation__c = false 
)</errorConditionFormula>
        <errorDisplayField>Rev_RecPlan_Receipt__c</errorDisplayField>
        <errorMessage>Revenue Recognition period cannot be earlier than the PO period.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Do_not_update_OIF</fullName>
        <active>false</active>
        <description>CRM-created.   To be temporarily activated during Product Hierarchy updates of Annual Plan deployments when users are allowed in the system but should have read-only access to OIFs.</description>
        <errorConditionFormula>AND($Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name,
OR(ISCHANGED(Opportunity__c),ISCHANGED(Business_Group__c) ,ISCHANGED(BusinessLine2__c),ISCHANGED(Business_Unit__c) ,ISCHANGED(BusinessLine__c),ISCHANGED( Forecast_Category__c ), ISCHANGED( OIF_Value__c ) ))</errorConditionFormula>
        <errorMessage>OIFs cannot be edited at this time due to ongoing changes to the product hierarchy.  Notification will be sent when editing is permissible.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Opportunity_Competitor_Check</fullName>
        <active>false</active>
        <errorConditionFormula>AND(
$Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name,
   ( Opportunity__r.Unweighted_Amount_EUR__c &gt;=VALUE($Label.OpportunityThreshouldValue)),
 Opportunity__r.NoOfCompetitor__c&lt;1,
OR(
 Opportunity__r.RecordType.DeveloperName = &apos;Direct_Record_Type&apos;,
Opportunity__r.RecordType.DeveloperName = &apos;Indirect_Record_Type&apos;
)

)</errorConditionFormula>
        <errorMessage>Request You to add at least one competitor to this Opportunity</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Sales_Phase_Validation</fullName>
        <active>true</active>
        <description>If Sales Phase on Oppty is NOT &apos;Handover&apos; or &apos;Execute&apos; and Forecast Category is &apos;Booked&apos;(Req:397)</description>
        <errorConditionFormula>OR(
AND( 
(ISNEW()||ISCHANGED(Forecast_Category__c)),
( $Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name),

NOT( 
OR( 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Handover (Prepare for Delivery)&apos;) 
, 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Execute (Start Delivery)&apos;), 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Completed&apos;) 

)
),
Opportunity__r.Advanced_PO_Booking__c = FALSE 
),
AND(
 (ISNEW()||ISCHANGED(Forecast_Category__c)),
( $Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name),
NOT( 
OR( 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Handover (Prepare for Delivery)&apos;) 
, 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Execute (Start Delivery)&apos;), 
ISPICKVAL( 
Opportunity__r.StageName ,&apos;Completed&apos;),
ISPICKVAL( Opportunity__r.StageName ,&apos;Win the Case (Negotiate)&apos;) 

)
),
Opportunity__r.Advanced_PO_Booking__c = TRUE
)
)

&amp;&amp; 
ISPICKVAL( Forecast_Category__c ,&apos;Booked&apos;)
&amp;&amp;
ISBLANK(Cloned_From__c)</errorConditionFormula>
        <errorDisplayField>Forecast_Category__c</errorDisplayField>
        <errorMessage>You cannot book OIF before Win Declaration is complete unless Advanced PO Booking is checked on Opportunity page and G4 approved.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Upsell_Oppty_Forecast_on_OIF_Creation</fullName>
        <active>false</active>
        <description>Feature 1700 = remove the Forecast Category restriction
(old: Requirement :4992. OIF categories to be blocked on creation.)</description>
        <errorConditionFormula>AND
(ISNEW(),
$Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name,
ISPICKVAL(Opportunity__r.Business_Type__c , &apos;Committed Upsell&apos;),
OR(Opportunity__r.RecordType.DeveloperName = &apos;Direct_Record_Type&apos;,
Opportunity__r.RecordType.DeveloperName = &apos;Indirect_Record_Type&apos;
),
OR(
ISPICKVAL(Forecast_Category__c , &apos;Excluded&apos;), 
ISPICKVAL(Forecast_Category__c , &apos;Cancelled&apos;), 
ISPICKVAL(Forecast_Category__c , &apos;Lost&apos;),
ISPICKVAL(Forecast_Category__c , &apos;Upside&apos;),
ISPICKVAL(Forecast_Category__c , &apos;RoP&apos;)
),
ISBLANK(Cloned_From__c)
)</errorConditionFormula>
        <errorMessage>You can only select Booked, Secure or Risk when creating an OIF line on a committed upsell opportunity.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Upsell_Oppty_Forecast_on_OIF_Updation</fullName>
        <active>false</active>
        <description>Feature 1700 = remove the Forecast Category restriction
(old: Requirement :4992. OIF categories to be blocked on updation.)</description>
        <errorConditionFormula>AND(
NOT(ISNEW()),
$Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name,
ISPICKVAL(Opportunity__r.Business_Type__c , &apos;Committed Upsell&apos;),
OR(
Opportunity__r.RecordType.DeveloperName = &apos;Direct_Record_Type&apos;, 
Opportunity__r.RecordType.DeveloperName = &apos;Indirect_Record_Type&apos;
),
OR
(ISPICKVAL(Forecast_Category__c , &apos;Upside&apos;),
ISPICKVAL(Forecast_Category__c , &apos;RoP&apos;))
)</errorConditionFormula>
        <errorMessage>You can only select Booked, Secure, Risk, Excluded, Cancelled or Lost when modifying an existing OIF line on a committed upsell opportunity.</errorMessage>
    </validationRules>
</CustomObject>
