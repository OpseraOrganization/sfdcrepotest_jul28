<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <validationRules>
        <fullName>Add_In_Versioning_Of_Uploaded_Document</fullName>
        <active>false</active>
        <description>#Req 064
Sprint 3
To Validate File Versioning on Offer  Object.</description>
        <errorConditionFormula>AND( 
( OR( Add_In_Version__c &lt; VALUE($Label.Excel_Add_In_Version), Add_In_Version__c = null)), 
!(ISCHANGED( Price__c )), 
$Profile.Name=$Label.Excel_Add_In_Profile_Name 
)</errorConditionFormula>
        <errorMessage>Please upload LoA File using New Add in Version . The version you tried to load is outdated. The Excel Add-in Version should be v2.7.0.0</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Customer_Offer_Due_Date_Validation</fullName>
        <active>true</active>
        <errorConditionFormula>AND( 
$Profile.Name  &lt;&gt; $Label.Data_Loader_Profile_Name, 
 
OR(Opportunity__r.RecordType.DeveloperName == &apos;Direct_Record_Type&apos;, 
Opportunity__r.RecordType.DeveloperName == &apos;Indirect_Record_Type&apos; ,Opportunity__r.RecordType.DeveloperName == &apos;Read_Only&apos;,Opportunity__r.RecordType.DeveloperName == &apos;Read_Only_Indirect&apos;) ,
NOT(
OR(
ISPICKVAL( Opportunity__r.StageName, &apos;Identify Opportunity&apos;),
ISPICKVAL( Opportunity__r.StageName, &apos;Develop Opportunity&apos;),
ISPICKVAL( Opportunity__r.StageName, &apos;Create Offer (Bid)&apos;))),  ISCHANGED( Customer_Offer_Due_Date__c ) )</errorConditionFormula>
        <errorMessage>It will not be possible to update the field once opportunity is G4 approved</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Edit_No_LoA</fullName>
        <active>true</active>
        <description>28Feb2020 Feature 1144 &amp; 2005: LoA Bypass = &quot;No LoA&quot; or &quot;Pre-approved price list for Account Manager&quot; can be selected only if an opportunity has been added in &quot;Reference Opportunity&quot; field and if that related oppty has been G4 approved with a LoA level.</description>
        <errorConditionFormula>AND(
$Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name,
OR(
Opportunity__r.RecordType.DeveloperName == &apos;Direct_Record_Type&apos;,
Opportunity__r.RecordType.DeveloperName == &apos;Indirect_Record_Type&apos;,
Opportunity__r.RecordType.DeveloperName == &apos;Read_Only&apos;,
Opportunity__r.RecordType.DeveloperName == &apos;Read_Only_Indirect&apos;),

AND
(
AND (ISCHANGED(LOA_Bypass__c), OR(ISPICKVAL(LOA_Bypass__c,&apos;No LoA&apos;), ISPICKVAL(LOA_Bypass__c,&apos;Pre-approved Price List for Account Managers&apos;) ) ),
OR (ISBLANK(Opportunity__r.Reference_Opportunity__r.G4_Approval_Date__c),ISBLANK(Opportunity__r.Reference_Opportunity__r.LOA_Level__c))

)

)</errorConditionFormula>
        <errorDisplayField>LOA_Bypass__c</errorDisplayField>
        <errorMessage>G4/G5 Bypass offer condition = &quot;G4 approved or contracted&quot; or &quot;Pre-approved price list for Account Manager&quot; can be selected only if an opportunity has been added in &quot;Reference Opportunity&quot; field and if that related oppty has been G4 approved</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Freeze_AppScope_After_G5</fullName>
        <active>true</active>
        <description>Freeze approval scope after G5 Approval</description>
        <errorConditionFormula>!ISNEW() &amp;&amp;
	ISCHANGED( Approval_Scope__c )  &amp;&amp;
	NOT(ISBLANK( Opportunity__r.G5_Approval_Date__c)) &amp;&amp;
	( ISPICKVAL(Opportunity__r.StageName , &quot;Handover (Prepare for Delivery)&quot;) ||
	ISPICKVAL(Opportunity__r.StageName , &quot;Execute (Start Delivery)&quot;) ||
	ISPICKVAL(Opportunity__r.StageName , &quot;Completed&quot;) ) &amp;&amp;
	$Profile.Name&lt;&gt; $Label.Data_Loader_Profile_Name &amp;&amp;
	$Profile.Name&lt;&gt; $Label.System_Admin_Profile &amp;&amp;
	$Profile.Name&lt;&gt; $Label.Global_Process_Admin_Profile_Name &amp;&amp;
	( Opportunity__r.RecordType.DeveloperName == &apos;Direct_Record_Type&apos; ||
	Opportunity__r.RecordType.DeveloperName == &apos;Indirect_Record_Type&apos; )</errorConditionFormula>
        <errorDisplayField>Approval_Scope__c</errorDisplayField>
        <errorMessage>This offer field cannot be edited after G5 approval</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Freeze_Description_After_G5</fullName>
        <active>true</active>
        <description>Freeze description after G5 Approval</description>
        <errorConditionFormula>!ISNEW() &amp;&amp;
	ISCHANGED(  Offer_Description__c ) &amp;&amp;
	NOT(ISBLANK( Opportunity__r.G5_Approval_Date__c)) &amp;&amp;
	( ISPICKVAL(Opportunity__r.StageName , &quot;Handover (Prepare for Delivery)&quot;) ||
	ISPICKVAL(Opportunity__r.StageName , &quot;Execute (Start Delivery)&quot;) ||
	ISPICKVAL(Opportunity__r.StageName , &quot;Completed&quot;) ) &amp;&amp;
	$Profile.Name&lt;&gt; $Label.Data_Loader_Profile_Name &amp;&amp;
	$Profile.Name&lt;&gt; $Label.System_Admin_Profile &amp;&amp;
	$Profile.Name&lt;&gt; $Label.Global_Process_Admin_Profile_Name &amp;&amp;
	( Opportunity__r.RecordType.DeveloperName == &apos;Direct_Record_Type&apos; ||
	Opportunity__r.RecordType.DeveloperName == &apos;Indirect_Record_Type&apos; )</errorConditionFormula>
        <errorDisplayField>Offer_Description__c</errorDisplayField>
        <errorMessage>This offer field cannot be edited after G5 approval</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Freeze_G4ApprovalDate_and_LoABypassOffer</fullName>
        <active>true</active>
        <description>Req 4802: Merge Offer Validation Rules</description>
        <errorConditionFormula>AND(
	OR(
	ISPICKVAL( Opportunity__r.StageName , &quot;Win the Case (Negotiate)&quot;), 
	ISPICKVAL( Opportunity__r.StageName , &quot;Handover (Prepare for Delivery)&quot;), 
	ISPICKVAL( Opportunity__r.StageName , &quot;Execute (Start Delivery)&quot;),
	ISPICKVAL( Opportunity__r.StageName , &quot;Completed&quot;)
	),
	$Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name, 
	OR(
		AND(
			!ISNULL(PRIORVALUE(G4_Approval_Date__c )),
			ISCHANGED( G4_Approval_Date__c ),
			G4_Approval_Date__c != DATEVALUE( Opportunity__r.G4_Approval_Date__c )
		),
		AND(
			ISCHANGED(LOA_Bypass__c),		
			OR( 
			Opportunity__r.RecordType.DeveloperName == &apos;Direct_Record_Type&apos;, 
			Opportunity__r.RecordType.DeveloperName == &apos;Indirect_Record_Type&apos;, 
			Opportunity__r.RecordType.DeveloperName == &apos;Read_Only&apos;, 
			Opportunity__r.RecordType.DeveloperName == &apos;Read_Only_Indirect&apos; 
			)
		)
	)
)</errorConditionFormula>
        <errorMessage>G4 Approval Date and G4/G5 Bypass offer condition are fixed and cannot be edited manually.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Freeze_NPI_C5_After_Successful_G4</fullName>
        <active>true</active>
        <description>Requirement 956: The ‘Pre C5 NPI support required’ field should remain editable till the opportunity reached Gate 4, and afterwards the answer should be frozen, to reflect the requirement at the time of offer submission.</description>
        <errorConditionFormula>AND(
$Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name,
  OR(G4_Approval_Date__c = TODAY(),
        G4_Approval_Date__c &lt; TODAY()
    ),
    ISCHANGED(Pre_C5_Flag_NPI__c)
)</errorConditionFormula>
        <errorDisplayField>Pre_C5_Flag_NPI__c</errorDisplayField>
        <errorMessage>You cannot edit &apos;Pre-C5 NPI Support Required&apos; after successful G4.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>LoA_mutually_exclusive_check</fullName>
        <active>true</active>
        <errorConditionFormula>AND(
  OR(AND(No_LoA__c = True,Pre_approved_Price_List_for_Acc_Managers__c = True), AND(Authorized_for_Pricing_Manager__c = True, No_LoA__c = True), AND(Pre_approved_Price_List_for_Acc_Managers__c = True, Authorized_for_Pricing_Manager__c = True), AND(Pre_approved_Price_List_for_Acc_Managers__c = True, Authorized_for_Pricing_Manager__c = True, No_LoA__c = True)),
  $Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name
  )</errorConditionFormula>
        <errorMessage>Among &quot;G4 approved or contracted&quot;, &quot;Authorized for Pricing Manager&quot;, only one can be checked at a time.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Offer_locked_at_Pending_Win_Loss</fullName>
        <active>true</active>
        <errorConditionFormula>AND(  
	$Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name,
	
	OR(
		Opportunity__r.RecordType.DeveloperName == &apos;Direct_Record_Type&apos;, 
		Opportunity__r.RecordType.DeveloperName == &apos;Indirect_Record_Type&apos;
		), OR(
	ISPICKVAL( Opportunity__r.Phase_Status__c , &apos;Pending Win/Loss Declaration&apos;), ISPICKVAL( Opportunity__r.Phase_Status__c , &apos;PTA (PROJECT TARGET AGREEMENT) HANDOVER TO DELIVERY/OPERATIONS&apos;),ISPICKVAL( Opportunity__r.Phase_Status__c , &apos;PTA (PROJECT TARGET AGREEMENT) HANDOVER TO DELIVERY/OPERATIONS&apos;),ISPICKVAL( Opportunity__r.Phase_Status__c , &apos;In Execution&apos;)) 
)</errorConditionFormula>
        <errorMessage>Active offer cannot be changed past G5</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Versioning_Of_Uploaded_Document</fullName>
        <active>false</active>
        <description>#Req 064
Sprint 3
To Validate File Versioning on Offer  Object.</description>
        <errorConditionFormula>AND( 
(Excel_File_Version__c &lt; VALUE($Label.Excel_File_Version)), 
!(ISCHANGED( Price__c )), 
$Profile.Name= $Label.Excel_Add_In_Profile_Name 
)</errorConditionFormula>
        <errorMessage>Please proceed with LoA data upload using Win the Deal tool. 
Is not permitted to upload with LoA file.</errorMessage>
    </validationRules>
</CustomObject>
